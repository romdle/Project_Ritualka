{% extends "base.html" %}
{% import "components.html" as ui %}

{% block title %}студия-гранита.рф — Каталог{% endblock %}

{% block content %}
  <section class="section catalog-section" data-catalog-page>
    <div class="container">
      <h1 class="catalog-title">Каталог памятников</h1>
      <p class="catalog-description">Мы создаём памятники с заботой и уважением к памяти ваших близких. Каждое изделие выполнено из качественных материалов и отражает вечную память.</p>

      <div class="catalog-filters-toggle">
        <button type="button" data-filter-open>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M4 6h16M7 12h10M10 18h4" />
          </svg>
          <span>Фильтры</span>
        </button>
      </div>

      <div class="catalog-layout">
        <aside class="catalog-sidebar" data-catalog-sidebar>
          <form id="catalog-filters-form" class="catalog-filters" method="get" data-price-min="{{ filters.price_min }}" data-price-max="{{ filters.price_max }}">
            <input type="hidden" name="category" value="{{ filters.category }}" />
            <input type="hidden" name="sort" value="{{ filters.sort }}" />
            <input type="hidden" name="price_from" value="{{ filters.price_from }}" />
            <input type="hidden" name="price_to" value="{{ filters.price_to }}" />

            <div class="catalog-filter-group">
              <h3 class="catalog-filters-heading">Категории</h3>
              <p class="catalog-filters-note">Выберите тип памятника.</p>
              <ul class="catalog-category-list">
                {% for category in categories %}
                  <li>
                    <button
                      type="button"
                      class="catalog-category-button{% if category.slug == filters.category %} is-active{% endif %}"
                      data-filter-category="{{ category.slug }}"
                      aria-pressed="{{ 'true' if category.slug == filters.category else 'false' }}"
                    >
                      <span>{{ category.label }}</span>
                    </button>
                  </li>
                {% endfor %}
              </ul>
            </div>

            <div class="catalog-filter-group">
              <h3 class="catalog-filters-heading">Сортировка</h3>
              <div class="catalog-sort-group">
                {% for option in sort_options %}
                  <button type="button" class="catalog-sort-button{% if option.value == filters.sort %} is-active{% endif %}" data-filter-sort="{{ option.value }}">
                    {% if option.icon == 'arrow-up' %}
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="8 11 12 7 16 11"></polyline><line x1="12" y1="7" x2="12" y2="17"></line></svg>
                    {% elif option.icon == 'arrow-down' %}
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="8 13 12 17 16 13"></polyline><line x1="12" y1="7" x2="12" y2="17"></line></svg>
                    {% elif option.icon == 'grid' %}
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="5" y="6" width="5" height="5" rx="1"></rect><rect x="14" y="6" width="5" height="5" rx="1"></rect><rect x="5" y="13" width="5" height="5" rx="1"></rect><rect x="14" y="13" width="5" height="5" rx="1"></rect></svg>
                    {% elif option.icon == 'letters' %}
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M7 16h5L9.5 7.5 7 16Zm8-7h5m-2.5-2v8"></path></svg>
                    {% endif %}
                    <span>{{ option.label }}</span>
                  </button>
                {% endfor %}
              </div>
            </div>

            <div class="catalog-filter-group catalog-price-range">
              <h3 class="catalog-filters-heading">Стоимость</h3>
              <p class="catalog-filters-note">Укажите диапазон цены.</p>
              <div class="catalog-price-values">
                <strong>{{ filters.price_from | int | format_number_ru }} ₽</strong>
                <strong>{{ filters.price_to | int | format_number_ru }} ₽</strong>
              </div>
              {% if filters.price_max > filters.price_min %}
                <div
                  class="catalog-range-slider"
                  data-price-slider
                  style="--range-min: {{ filters.price_min }}; --range-max: {{ filters.price_max }}; --range-from: {{ filters.price_from }}; --range-to: {{ filters.price_to }};"
                >
                  <input type="range" min="{{ filters.price_min }}" max="{{ filters.price_max }}" value="{{ filters.price_from }}" step="{{ slider_step }}" data-price-input="from" />
                  <input type="range" min="{{ filters.price_min }}" max="{{ filters.price_max }}" value="{{ filters.price_to }}" step="{{ slider_step }}" data-price-input="to" />
                </div>
              {% else %}
                <div class="catalog-range-slider" data-price-slider>
                  <input type="range" disabled />
                  <input type="range" disabled />
                </div>
              {% endif %}
              <button type="button" class="catalog-reset" data-filter-reset>Сбросить фильтры</button>
            </div>
          </form>
        </aside>

        <div class="catalog-content">
          {% if products %}
            <div class="product-row product-row--catalog">
              {% for product in products %}
                {{ ui.product_card(product) }}
              {% endfor %}
            </div>
          {% else %}
            {{ ui.status_card('По выбранным условиям ничего не найдено.') }}
          {% endif %}
        </div>
      </div>
    </div>

    <div class="catalog-overlay" data-catalog-overlay>
      <div class="catalog-overlay-panel">
        <button class="catalog-overlay-close" type="button" data-filter-close>Закрыть</button>
        <h2 class="catalog-overlay-heading">Фильтры</h2>
        <div data-catalog-overlay-content></div>
      </div>
    </div>
  </section>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('scripts', path='catalog.js') }}" defer></script>
{% endblock %}